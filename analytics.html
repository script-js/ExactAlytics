<!DOCTYPE HTML>
<html>
  <head>
    <link rel="stylesheet" href="https://script-js.github.io/js-css/urun.css" />
    <title>ExactAlytics Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Schibsted+Grotesk:ital,wght@0,400..900;1,400..900&display=swap" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>* {font-family: "Schibsted Grotesk", sans-serif}</style>
  </head>
  <body style="text-align:center">
  <h1>ExactAlytics Dashboard</h1>
  <div id="alltop" class="flex">Loading Data...</div>
  <script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getDatabase, ref, update, get, child } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  const firebaseConfig = {

    apiKey: "AIzaSyAwBo-LBbTZWimOAkgByg9zVd3sgwdON6U",

    authDomain: "exactalytics.firebaseapp.com",

    projectId: "exactalytics",

    storageBucket: "exactalytics.appspot.com",

    messagingSenderId: "2502194733",

    appId: "1:2502194733:web:8b3ef42a216fa6bfbf2aa4"

  };


  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const db = getDatabase();
  const dbRef = ref(db);

  function decodeFB(text2) {
     var text1 = text2.replaceAll("%2E",".").replaceAll("%23","#").replaceAll("%24","$").replaceAll("%2F","/").replaceAll("%5B","[").replaceAll("%5D","]").replaceAll('%22','"')
     return text1;
   }

  get(child(dbRef, "/analytics")).then((snapshot) => {
  if (snapshot.exists()) {
    var tosort = {}
      var an = snapshot.val()
    var atText = "";
    Object.keys(an).forEach(function (k) {
      atText = atText + "<div class='extension'><h2 class='eTitle'>" + decodeFB(k) + "</h1>Site visits: " + an[k].clicks + "<br>Users: " + an[k].users + "<p><button class='eBtn' onclick='getPageClicks(" + '"' + k + '"' + ",this)'>Views by Page</button></p></div>";
    });
    alltop.innerHTML = atText
  } else {alltop.innerHTML = "No Data Yet"};
});
    function getPageClicks(id,btn) {
      get(child(dbRef, "/analytics/" + id + "/pages")).then((snapshot) => {
  if (snapshot.exists()) {
      var an = snapshot.val()
    var atText = "";
    Object.keys(an).forEach(function (k) {
      atText = atText + "<br>" + decodeFB(k) + ": " + an[k] + " visits";
    });
   btn.parentElement.innerHTML = atText
  } else {btn.parentElement.innerHTML = "No Analytics Data"};
});
    }
    window.getPageClicks = getPageClicks
  </script>
  </body>
</html>
